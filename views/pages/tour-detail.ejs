<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
     <%- include('../partials/head', { 
          title: `${tour.title} | Morocco Travel Experts`,
          metaDescription: `Experience ${tour.title}. ${tour.duration} days from ${tour.startLocation}. Book now!`,
          metaKeywords: `morocco tours, ${tour.startLocation} tours, morocco travel, ${tour.duration} day tours, ${tour.title}`,
          canonicalUrl: `https://moroccotravelexperts.com/tours/${tour.slug}`,
          ogImage: tour.mainImage,
          ogImageAlt: `${tour.title} - Experience Morocco Travel`,
          ogType: 'product',
          price: tour.price,
          currency: 'USD',
          availability: 'instock',
          tourDuration: tour.duration
     }) %>
     
     <style>
          /* Core layout and scrolling */
          html {
               scroll-behavior: smooth;
               scroll-padding-top: 70px;
          }
          .hide-scrollbar {
               -ms-overflow-style: none;
               scrollbar-width: none;
          }
          .hide-scrollbar::-webkit-scrollbar {
               display: none;
          }
          
          /* Typography - Apple-inspired clean typography */
          body {
               font-family: -apple-system, BlinkMacSystemFont, "San Francisco", "Helvetica Neue", Helvetica, Arial, sans-serif;
               -webkit-font-smoothing: antialiased;
               -moz-osx-font-smoothing: grayscale;
               color: #1d1d1f;
               line-height: 1.5;
               letter-spacing: -0.015em;
          }
          
          h1, h2, h3, h4, h5, h6 {
               font-weight: 600;
               letter-spacing: -0.025em;
          }
          
          /* Clean, simple section heading */
          .section-heading {
               font-size: 2.5rem;
               font-weight: 600;
               letter-spacing: -0.025em;
               margin-bottom: 2rem;
               color: #1d1d1f;
          }
          
          /* Content container with reasonable width */
          .content-container {
               /* max-width: 1100px;
               margin-left: auto;
               margin-right: auto; */
               /* padding: 0 24px; */
          }
          
          /* Card styling with subtle effects */
          .apple-card {
               background-color: white;
               border-radius: 14px;
               box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
               transition: box-shadow 0.3s ease;
               overflow: hidden;
          }
          
          .apple-card:hover {
               box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
          }
          
          /* Subtle image hover effect */
          .img-container {
               overflow: hidden;
               position: relative;
          }
          
          .img-container img {
               transition: transform 1.2s cubic-bezier(0.16, 1, 0.3, 1);
          }
          
          .img-container:hover img {
               transform: scale(1.05);
          }
          
          /* Navigation styles */
          .nav-link {
               position: relative;
               color: #1d1d1f;
               font-weight: 500;
          }
          
          .nav-link::after {
               content: "";
               position: absolute;
               bottom: 0;
               left: 50%;
               width: 0;
               height: 1px;
               background: currentColor;
               transform: translateX(-50%);
               transition: width 0.3s ease;
          }
          
          .nav-link:hover::after, 
          .nav-link.active::after {
               width: 60%;
          }
          
          /* Clean form elements */
          .apple-input {
               padding: 12px 16px;
               border-radius: 10px;
               border: 1px solid #d2d2d7;
               background: #fff;
               font-size: 1rem;
               transition: all 0.2s ease;
               width: 100%;
               outline: none;
          }
          
          .apple-input:focus {
               border-color: #f97316;
               box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.15);
          }
          
          .apple-label {
               font-size: 0.875rem;
               color: #6e6e73;
               margin-bottom: 8px;
               display: block;
          }
          
          /* Button styles */
          .apple-button {
               display: inline-block;
               padding: 12px 24px;
               background-color: #f97316;
               color: white;
               font-size: 1rem;
               font-weight: 500;
               border-radius: 980px;
               border: none;
               cursor: pointer;
               text-align: center;
               transition: all 0.2s ease;
          }
          
          .apple-button:hover {
               background-color: #fb923c;
          }
          
          .apple-button-secondary {
               background-color: #f5f5f7;
               color: #1d1d1f;
               border: 1px solid #d2d2d7;
          }
          
          .apple-button-secondary:hover {
               background-color: #e8e8ed;
          }
          
          /* Modal styles */
          .modal {
               position: fixed;
               top: 0;
               left: 0;
               right: 0;
               bottom: 0;
               background-color: rgba(0, 0, 0, 0.5);
               display: flex;
               align-items: center;
               justify-content: center;
               opacity: 0;
               pointer-events: none;
               transition: opacity 0.3s ease;
               z-index: 100;
          }
          
          .modal.active {
               opacity: 1;
               pointer-events: auto;
          }
          
          .modal-content {
               background-color: white;
               border-radius: 14px;
               max-width: 90%;
               width: 500px;
               max-height: 90vh;
               overflow-y: auto;
               box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
               transform: translateY(20px);
               transition: transform 0.3s ease;
          }
          
          .modal.active .modal-content {
               transform: translateY(0);
          }
          
          /* Floating action button */
          .float-button {
               position: fixed;
               bottom: 20px;
               right: 20px;
               width: auto;
               z-index: 50;
               box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          }
          
          /* Apple-style accordion */
          .accordion-item {
               border-radius: 12px;
               overflow: hidden;
               margin-bottom: 16px;
               background: white;
               border: 1px solid #e8e8ed;
          }
          
          .accordion-header {
               padding: 16px 24px;
               font-weight: 500;
               cursor: pointer;
               display: flex;
               align-items: center;
               justify-content: space-between;
               color: #1d1d1f;
          }
          
          .accordion-content {
               padding: 0 24px 24px;
          }
          
          /* Clean gallery styling */
          .gallery-grid {
               display: grid;
               grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
               gap: 24px;
          }
          
          .gallery-item {
               border-radius: 12px;
               overflow: hidden;
               aspect-ratio: 4/3;
          }
          
          /* Alternating section backgrounds */
          .section-white {
               background-color: #ffffff;
               padding: 5rem 0;
          }
          
          .section-gray {
               background-color: #f5f5f7;
               padding: 5rem 0;
          }
          
          /* Section headings with subtle underline */
          .clean-heading {
               font-size: 2.25rem;
               font-weight: 600;
               letter-spacing: -0.025em;
               position: relative;
               display: inline-block;
               margin-bottom: 2.5rem;
               color: #1d1d1f;
          }
          
          .clean-heading::after {
               content: "";
               position: absolute;
               left: 0;
               bottom: -0.75rem;
               width: 3rem;
               height: 3px;
               background-color: #0071e3;
               border-radius: 2px;
          }
          
          /* Scrollable details container */
          .scrollable-details {
               max-height: 320px;
               overflow-y: auto;
               padding-right: 1rem;
               margin-right: -1rem;
               -webkit-overflow-scrolling: touch;
          }
          
          .scrollable-details::-webkit-scrollbar {
               width: 4px;
          }
          
          .scrollable-details::-webkit-scrollbar-track {
               background: #f1f1f1;
               border-radius: 10px;
          }
          
          .scrollable-details::-webkit-scrollbar-thumb {
               background: #c1c1c1;
               border-radius: 10px;
          }
          
          .scrollable-details::-webkit-scrollbar-thumb:hover {
               background: #a8a8a8;
          }
          
          /* Responsive adjustments */
          @media (max-width: 768px) {
               .content-container {
                    padding: 0 16px;
               }
               .section-heading {
                    font-size: 1.75rem;
               }
               .clean-heading {
                    font-size: 1.5rem;
               }
               .scrollable-details {
                    max-height: 280px;
               }
          }
     </style>
</head>

<body class="bg-white font-sans text-[#1d1d1f]">
     <%- include('../partials/header') %>

     <!-- Main content -->
     <main class="pt-20 pb-16 bg-white">
         

          <!-- Content Container -->
          <div class="container mx-auto max-w-7xl px-4 md:px-8 ">
               <!-- Tour Details Section -->
               <div class="flex flex-col md:flex-row">
                    <!-- Main Content -->
                    <div class="w-full">
                         <!-- Apple-style Header Section -->
                         <section class="pt-24 pb-12 bg-white">
                              <div class="content-container">
                                   <!-- Tour Title and Subtitle -->
                                   <div class="max-w-3xl mb-10">
                                        <h1 class="text-4xl md:text-5xl font-semibold tracking-tight mb-6">
                                             <%= tour.title %>
                                        </h1>
                                        <p class="text-xl text-[#6e6e73] leading-relaxed">
                                             Discover the beauty of Morocco with our <%= tour.duration %>-day journey starting from <%= tour.startLocation %>.
                                        </p>
                                   </div>
                                   
                                   <!-- Tour Quick Info -->
                                   <div class="flex flex-wrap gap-x-12 gap-y-5 mb-8 text-[#6e6e73]">
                                        <div class="flex items-center">
                                             <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                  <circle cx="12" cy="12" r="10"></circle>
                                                  <polyline points="12 6 12 12 16 14"></polyline>
                                             </svg>
                                             <span><%= tour.duration %> Days</span>
                                        </div>
                                        <div class="flex items-center">
                                             <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                                  <circle cx="12" cy="10" r="3"></circle>
                                             </svg>
                                             <span><%= tour.startLocation %></span>
                                        </div>
                                        <div class="flex items-center">
                                             <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                                  <circle cx="9" cy="7" r="4"></circle>
                                                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                             </svg>
                                             <span>Max <%= tour.groupSize %> travelers</span>
                                        </div>
                                        <div class="flex items-center">
                                             <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                  <circle cx="12" cy="7" r="4"></circle>
                                             </svg>
                                             <span><%= tour.accommodation %></span>
                                        </div>
                                   </div>
                                   
                                   <!-- Call to Action Buttons -->
                                   <div class="flex flex-wrap gap-4">
                                        <a href="#booking" class="apple-button">
                                             Book This Tour
                                        </a>
                                        <a href="mailto:book@moroccotravelexperts.com" class="inline-flex items-center px-6 py-3 text-base font-medium text-[#0071e3] bg-white border border-[#0071e3] rounded-lg hover:bg-[#0071e3] hover:text-white transition-colors duration-200">
                                             Contact Us
                                        </a>
                                   </div>
                              </div>
                         </section>
                         
                         <!-- Clean Navigation Bar -->
                         <div class="sticky top-0 bg-white bg-opacity-95 backdrop-blur-sm z-30 border-b border-gray-100">
                              <div class="content-container">
                                   <div class="flex overflow-x-auto hide-scrollbar justify-center">
                                        <a href="#overview" class="nav-link px-6 py-4 whitespace-nowrap">Overview</a>
                                        <a href="#itinerary" class="nav-link px-6 py-4 whitespace-nowrap">Itinerary</a>
                                        <a href="#gallery" class="nav-link px-6 py-4 whitespace-nowrap">Gallery</a>
                                        <a href="#includes" class="nav-link px-6 py-4 whitespace-nowrap">Details</a>
                                        <a href="#booking" class="nav-link px-6 py-4 whitespace-nowrap">Book</a>
                                   </div>
                              </div>
                         </div>

                         <!-- ===== START: TOUR CONTENT SECTION ===== -->
                         <!-- Overview Section - White Background -->
                         <section class="section-white">
                              <div class="content-container">
                                   <div id="overview">
                                        <h2 class="clean-heading">Overview</h2>
                                        <div class="text-lg leading-relaxed text-[#1d1d1f] space-y-6">
                                             <%= tour.description %>
                                        </div>
                                   </div>
                              </div>
                         </section>

                         <!-- Itinerary Section - Gray Background -->
                         <section class="section-gray">
                              <div class="content-container">
                                   <div id="itinerary">
                                        <h2 class="clean-heading">Day by Day Itinerary</h2>
                                        <div class="space-y-6">
                                             <% tour.itinerary.forEach((day, index) => { %>
                                             <div class="accordion-item overflow-hidden">
                                                  <div class="accordion-header" onclick="toggleCollapse(this)">
                                                       <div class="flex items-center">
                                                            <span class="w-8 h-8 rounded-full bg-[#f5f5f7] flex items-center justify-center text-[#0071e3] mr-4">
                                                                 <%= index + 1 %>
                                                            </span>
                                                            <h3 class="text-lg font-medium"><%= day.title %></h3>
                                                       </div>
                                                       <svg class="w-6 h-6 text-[#86868b]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 9l-7 7-7-7" />
                                                       </svg>
                                                  </div>
                                                  <div class="accordion-content hidden">
                                                       <div class="text-[#1d1d1f] space-y-4">
                                                            <p><%= day.description %></p>
                                                       </div>
                                                       <% if (day.image) { %>
                                                       <div class="mt-6 rounded-xl overflow-hidden">
                                                            <img src="<%= day.image %>" alt="<%= day.title %>" class="w-full h-auto">
                                                       </div>
                                                       <% } %>
                                                  </div>
                                             </div>
                                             <% }) %>
                                        </div>
                                   </div>
                              </div>
                         </section>

                         <!-- Gallery Section - White Background -->
                         <section class="section-white">
                              <div class="content-container">
                                   <div id="gallery">
                                        <h2 class="clean-heading">Tour Gallery</h2>
                                        <div class="gallery-grid">
                                             <% tour.images.forEach(image => { %>
                                             <a href="<%= image %>" class="gallery-item block">
                                                  <div class="img-container h-full">
                                                       <img src="<%= image %>" alt="Tour Image" class="w-full h-full object-cover">
                                                  </div>
                                             </a>
                                             <% }) %>
                                        </div>
                                   </div>
                              </div>
                         </section>

                         <!-- Tour Details Section with Scrollable Content - Gray Background -->
                         <section class="section-gray">
                              <div class="content-container">
                                   <div id="includes">
                                        <h2 class="clean-heading">Tour Details</h2>
                                        <div class="grid md:grid-cols-2 gap-12">
                                             <!-- What's Included - Scrollable -->
                                             <div class="apple-card p-6">
                                                  <h3 class="text-xl font-medium mb-4">What's Included</h3>
                                                  <div class="scrollable-details">
                                                       <ul class="space-y-4">
                                                            <% tour.includes.forEach(item => { %>
                                                            <li class="flex">
                                                                 <svg class="w-5 h-5 text-[#0071e3] mt-1 mr-3 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                      <polyline points="20 6 9 17 4 12"></polyline>
                                                                 </svg>
                                                                 <span><%= item %></span>
                                                            </li>
                                                            <% }) %>
                                                       </ul>
                                                  </div>
                                             </div>
                                             
                                             <!-- What's Not Included - Scrollable -->
                                             <div class="apple-card p-6">
                                                  <h3 class="text-xl font-medium mb-4">Not Included</h3>
                                                  <div class="scrollable-details">
                                                       <ul class="space-y-4">
                                                            <% tour.excludes.forEach(item => { %>
                                                            <li class="flex">
                                                                 <svg class="w-5 h-5 text-[#86868b] mt-1 mr-3 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                      <line x1="18" y1="6" x2="6" y2="18"></line>
                                                                      <line x1="6" y1="6" x2="18" y2="18"></line>
                                                                 </svg>
                                                                 <span><%= item %></span>
                                                            </li>
                                                            <% }) %>
                                                       </ul>
                                                  </div>
                                             </div>
                                        </div>
                                   </div>
                              </div>
                         </section>
                         
                         <!-- Key Attractions Section - White Background -->
                         <% if (tour.keyHighlights && Array.isArray(tour.keyHighlights) && tour.keyHighlights.length > 0) { %>
                         <section class="section-white">
                              <div class="content-container">
                                   <div id="attractions">
                                        <h2 class="clean-heading">Key Attractions</h2>
                                        
                                        <div class="grid md:grid-cols-2 gap-8">
                                             <% tour.keyHighlights.forEach(highlight => { %>
                                             <div class="flex">
                                                  <div class="mr-4 text-[#0071e3]">
                                                       <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                            <path d="M12 2L5 12 12 22 19 12 12 2Z"></path>
                                                            <path d="M3 12h18"></path>
                                                       </svg>
                                                  </div>
                                                  <div>
                                                       <h3 class="text-lg font-medium mb-1"><%= highlight %></h3>
                                                  </div>
                                             </div>
                                             <% }) %>
                                        </div>
                                   </div>
                              </div>
                         </section>
                         <% } else if (tour.highlights && Array.isArray(tour.highlights) && tour.highlights.length > 0) { %>
                         <!-- Fall back to tour.highlights if keyHighlights doesn't exist -->
                         <section class="section-white">
                              <div class="content-container">
                                   <div id="attractions">
                                        <h2 class="clean-heading">Key Attractions</h2>
                                        
                                        <div class="grid md:grid-cols-2 gap-8">
                                             <% tour.highlights.forEach(highlight => { %>
                                             <div class="flex">
                                                  <div class="mr-4 text-[#0071e3]">
                                                       <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                            <path d="M12 2L5 12 12 22 19 12 12 2Z"></path>
                                                            <path d="M3 12h18"></path>
                                                       </svg>
                                                  </div>
                                                  <div>
                                                       <h3 class="text-lg font-medium mb-1"><%= highlight %></h3>
                                                  </div>
                                             </div>
                                             <% }) %>
                                        </div>
                                   </div>
                              </div>
                         </section>
                         <% } %>
                         
                         <!-- Additional Info - Gray Background -->
                         <section class="section-gray">
                              <div class="content-container">
                                   <div class="bg-white rounded-2xl p-8">
                                        <div class="flex flex-col md:flex-row md:items-center">
                                             <div class="mb-6 md:mb-0 md:mr-8">
                                                  <svg class="w-12 h-12 text-[#f97316]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                       <circle cx="12" cy="12" r="10"></circle>
                                                       <line x1="12" y1="16" x2="12" y2="12"></line>
                                                       <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                                  </svg>
                                             </div>
                                             <div>
                                                  <h3 class="text-xl font-medium mb-2">Have Questions or Special Requirements?</h3>
                                                  <p class="text-[#6e6e73] mb-4">Feel free to reach out to us directly for any custom booking requests or questions about this tour.</p>
                                                  <a href="mailto:book@moroccotravelexperts.com" class="text-[#f97316] font-medium hover:underline">
                                                       book@moroccotravelexperts.com
                                                  </a>
                                             </div>
                                        </div>
                                   </div>
                              </div>
                         </section>
                         
                         <!-- Tour Summary Button (Fixed Position) -->
                         <button 
                              id="tourSummaryBtn"
                              class="fixed bottom-6 right-6 bg-[#FF8C00] hover:bg-[#E67E00] text-white font-semibold py-3 px-6 rounded-full shadow-lg flex items-center space-x-2 z-40"
                         >
                              <span>Tour Summary</span>
                              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                   <path fill-rule="evenodd" d="M4 5a2 2 0 012-2h8a2 2 0 012 2v14l-6-3-6 3V5z" clip-rule="evenodd" />
                              </svg>
                         </button>

                         <!-- Tour Summary Modal -->
                         <div id="tourSummaryModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
                              <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-2xl max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                                   <!-- Modal Header -->
                                   <div class="p-4 border-b border-gray-200 flex justify-between items-center sticky top-0 bg-white z-10">
                                        <h3 class="text-xl font-semibold text-gray-900">Tour Summary</h3>
                                        <button onclick="closeTourSummaryModal()" class="text-gray-400 hover:text-gray-500">
                                             <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                             </svg>
                                        </button>
                                   </div>
                                   
                                   <!-- Modal Content -->
                                   <div class="p-6">
                                        <!-- Tour Quick Facts -->
                                        <div class="mb-6">
                                             <h4 class="font-bold text-lg mb-3">Quick Facts</h4>
                                             <div class="grid grid-cols-2 gap-4">
                                                  <div class="flex items-start">
                                                       <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#FF8C00] mr-2 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                       </svg>
                                                       <div>
                                                            <p class="text-sm text-gray-500">Duration</p>
                                                            <p class="font-medium"><%= tour.duration %> days</p>
                                                       </div>
                                                  </div>
                                                  <div class="flex items-start">
                                                       <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#FF8C00] mr-2 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                                       </svg>
                                                       <div>
                                                            <p class="text-sm text-gray-500">Group Size</p>
                                                            <p class="font-medium"><%= tour.groupSize %> people</p>
                                                       </div>
                                                  </div>
                                                  <div class="flex items-start">
                                                       <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#FF8C00] mr-2 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                                                       </svg>
                                                       <div>
                                                            <p class="text-sm text-gray-500">Difficulty</p>
                                                            <p class="font-medium"><%= tour.difficulty %></p>
                                                       </div>
                                                  </div>
                                                  <div class="flex items-start">
                                                       <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#FF8C00] mr-2 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                                       </svg>
                                                       <div>
                                                            <p class="text-sm text-gray-500">Accommodation</p>
                                                            <p class="font-medium"><%= tour.accommodation %></p>
                                                       </div>
                                                  </div>
                                             </div>
                                        </div>
                                        
                                        <!-- Price Section -->
                                        <div class="border-t border-gray-200 pt-6 mb-6">
                                             <h4 class="font-bold text-lg mb-3">Price</h4>
                                             <div class="flex items-baseline">
                                                  <span class="text-3xl font-bold text-[#FF8C00]">$<%= tour.price %></span>
                                                  <span class="text-gray-500 ml-2">per person</span>
                                             </div>
                                             <p class="text-sm text-gray-600 mt-2">Includes accommodation, transportation, and guided tours</p>
                                        </div>
                                        
                                        <!-- Booking Button -->
                                        <a href="/booking/<%= tour.id %>" class="block w-full bg-[#FF8C00] hover:bg-[#E67E00] text-white text-center font-bold py-3 px-4 rounded-lg transition duration-200">
                                             Book Now
                                        </a>
                                   </div>
                              </div>
                         </div>
                         
                         <!-- Booking Section - White Background -->
                         <section id="booking" class="section-white">
                              <div class="content-container max-w-4xl mx-auto">
                                   <h2 class="clean-heading text-center">Book Your Tour</h2>
                                   <p class="text-center text-[#6e6e73] text-lg mb-8 max-w-xl mx-auto">
                                        Ready to experience the beauty of Morocco? Fill out the form below to secure your spot on this unforgettable journey.
                                   </p>
                                   
                                   <div class="apple-card p-8 md:p-12">
                                        <form id="tourBookingForm" class="space-y-8">
                                             <input type="hidden" name="tourId" value="<%= tour._id %>">
                                             <input type="hidden" name="tourName" value="<%= tour.title %>">
                                             
                                             <!-- Personal Information Section -->
                                             <div>
                                                  <h3 class="text-xl font-medium mb-6 flex items-center">
                                                       <svg class="w-6 h-6 mr-2 text-[#0071e3]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                            <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"></path>
                                                            <circle cx="12" cy="7" r="4"></circle>
                                                       </svg>
                                                       Personal Information
                                                  </h3>
                                                  
                                                  <div class="grid md:grid-cols-2 gap-6">
                                                       <div>
                                                            <label for="firstName" class="apple-label">First Name</label>
                                                            <input type="text" id="firstName" name="firstName" required class="apple-input">
                                                       </div>
                                                       <div>
                                                            <label for="lastName" class="apple-label">Last Name</label>
                                                            <input type="text" id="lastName" name="lastName" required class="apple-input">
                                                       </div>
                                                  </div>

                                                  <div class="grid md:grid-cols-2 gap-6 mt-6">
                                                       <div>
                                                            <label for="email" class="apple-label">Email</label>
                                                            <input type="email" id="email" name="email" required class="apple-input">
                                                       </div>
                                                       <div>
                                                            <label for="phone" class="apple-label">Phone Number</label>
                                                            <input type="tel" id="phone" name="phone" required class="apple-input">
                                                       </div>
                                                  </div>
                                             </div>
                                             
                                             <!-- Tour Details Section -->
                                             <div class="pt-4">
                                                  <h3 class="text-xl font-medium mb-6 flex items-center">
                                                       <svg class="w-6 h-6 mr-2 text-[#0071e3]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                                            <line x1="16" y1="2" x2="16" y2="6"></line>
                                                            <line x1="8" y1="2" x2="8" y2="6"></line>
                                                            <line x1="3" y1="10" x2="21" y2="10"></line>
                                                       </svg>
                                                       Tour Details
                                                  </h3>
                                                  
                                                  <div class="grid md:grid-cols-2 gap-6">
                                                       <div>
                                                            <label for="startDate" class="apple-label">Start Date</label>
                                                            <input type="date" id="startDate" name="startDate" required class="apple-input"
                                                                 min="<%= new Date().toISOString().split('T')[0] %>">
                                                       </div>
                                                       <div>
                                                            <label for="groupSize" class="apple-label">Number of People</label>
                                                            <input type="number" id="groupSize" name="groupSize" min="1" max="<%= tour.groupSize %>" value="1" required class="apple-input">
                                                       </div>
                                                  </div>
                                             </div>
                                             
                                             <!-- Special Requests Section -->
                                             <div class="pt-4">
                                                  <h3 class="text-xl font-medium mb-6 flex items-center">
                                                       <svg class="w-6 h-6 mr-2 text-[#0071e3]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                                       </svg>
                                                       Special Requests
                                                  </h3>
                                                  
                                                  <div>
                                                       <label for="specialRequests" class="apple-label">Additional Information or Requests</label>
                                                       <textarea id="specialRequests" name="specialRequests" rows="4" class="apple-input"></textarea>
                                                  </div>
                                             </div>
                                             
                                             <!-- Form status messages -->
                                             <div id="bookingFormStatus" class="hidden"></div>

                                             <!-- Submit Button -->
                                             <div class="pt-4">
                                                  <button type="submit" class="apple-button w-full py-4 text-lg">
                                                       Book This Tour
                                                  </button>

                                                  <p class="text-sm text-[#6e6e73] text-center mt-4">
                                                       By booking, you agree to our <a href="/terms" class="text-[#0071e3] hover:underline">Terms & Conditions</a>
                                                  </p>
                                             </div>
                                        </form>
                                   </div>
                              </div>
                         </section>
                         <!-- ===== END: TOUR CONTENT SECTION ===== -->
                    </div>
               </div>
          </div>
     </main>

     <!-- Related Tours Section -->
     <% if (relatedTours && relatedTours.length > 0) { %>
     <section class="py-24 bg-[#f5f5f7]">
          <div class="content-container">
               <h2 class="section-heading">You May Also Like</h2>
               
               <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-10">
                    <% relatedTours.forEach(relatedTour => { %>
                    <a href="/tours/<%= relatedTour.slug %>" class="group">
                         <div class="apple-card h-full overflow-hidden">
                              <div class="img-container aspect-video">
                                   <img 
                                        src="<%= relatedTour.mainImage %>" 
                                        alt="<%= relatedTour.title %>" 
                                        class="w-full h-full object-cover"
                                   >
                              </div>
                              <div class="p-6">
                                   <div class="flex justify-between items-center mb-3 text-sm text-[#6e6e73]">
                                        <span class="flex items-center">
                                             <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                  <circle cx="12" cy="12" r="10"/>
                                                  <polyline points="12 6 12 12 16 14"/>
                                             </svg>
                                             <%= relatedTour.duration %> Days
                                        </span>
                                        <span class="flex items-center">
                                             <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
                                                  <circle cx="12" cy="10" r="3"/>
                                             </svg>
                                             <%= relatedTour.startLocation %>
                                        </span>
                                   </div>
                                   <h3 class="text-xl font-medium mb-2 group-hover:text-[#0071e3] transition-colors"><%= relatedTour.title %></h3>
                                   <p class="text-[#6e6e73] line-clamp-2"><%= relatedTour.description.substring(0, 100) %>...</p>
                              </div>
                         </div>
                    </a>
                    <% }) %>
               </div>
          </div>
     </section>
     <% } %>

     <!-- Back-to-top Button -->
     <button id="backToTop" class="fixed bottom-8 right-8 bg-white shadow-lg text-[#0071e3] p-3 rounded-full opacity-0 invisible transition-all duration-300 border border-gray-200 focus:outline-none z-50 hover:shadow-xl">
          <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
               <path d="M12 19V5M5 12l7-7 7 7"/>
          </svg>
     </button>
     
     <%- include('../partials/footer') %>
     
     <script>
          // Toggle collapse sections
          function toggleCollapse(element) {
               const content = element.nextElementSibling;
               const icon = element.querySelector('svg');
               
               if (content.classList.contains('hidden')) {
                    content.classList.remove('hidden');
                    if (icon) icon.style.transform = 'rotate(180deg)';
               } else {
                    content.classList.add('hidden');
                    if (icon) icon.style.transform = 'rotate(0deg)';
               }
          }
          
          // Back to top button
          const backToTopButton = document.getElementById('backToTop');
          
          window.addEventListener('scroll', () => {
               if (window.scrollY > 300) {
                    backToTopButton.classList.remove('opacity-0', 'invisible');
                    backToTopButton.classList.add('opacity-100', 'visible');
               } else {
                    backToTopButton.classList.add('opacity-0', 'invisible');
                    backToTopButton.classList.remove('opacity-100', 'visible');
               }
          });
          
          backToTopButton.addEventListener('click', () => {
               window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
               });
          });
          
          // Add active class to navigation links based on scroll position
          const sections = document.querySelectorAll('section div[id]');
          const navLinks = document.querySelectorAll('.nav-link');
          
          window.addEventListener('scroll', () => {
               let current = '';
               
               sections.forEach(section => {
                    const sectionTop = section.getBoundingClientRect().top;
                    
                    if (sectionTop <= 120) {
                         current = section.getAttribute('id');
                    }
               });
               
               navLinks.forEach(link => {
                    link.classList.remove('active');
                    
                    if (link.getAttribute('href').substring(1) === current) {
                         link.classList.add('active');
                    }
               });
          });

          // Ajax form submission
          document.getElementById('tourBookingForm').addEventListener('submit', function(e) {
               e.preventDefault();
               
               // Show loading state
               const submitButton = this.querySelector('button[type="submit"]');
               const originalButtonText = submitButton.innerHTML;
               submitButton.disabled = true;
               submitButton.innerHTML = '<svg class="animate-spin -ml-1 mr-2 h-5 w-5 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Processing...';
               
               // Get form data
               const formData = new FormData(this);
               const formDataObject = Object.fromEntries(formData.entries());
               
               // Format data to match backend schema
               const bookingData = {
                    tourId: formDataObject.tourId,
                    tourName: formDataObject.tourName,
                    firstName: formDataObject.firstName, 
                    lastName: formDataObject.lastName,
                    email: formDataObject.email,
                    phone: formDataObject.phone,
                    startDate: formDataObject.startDate,
                    groupSize: formDataObject.groupSize,
                    specialRequests: formDataObject.specialRequests
               };
               
               // Send Ajax request
               fetch('/tour-booking', {
                    method: 'POST',
                    headers: {
                         'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(bookingData)
               })
               .then(response => {
                    if (!response.ok) {
                         throw new Error('Network response was not ok');
                    }
                    return response.json();
               })
               .then(data => {
                    // Show success message
                    const statusDiv = document.getElementById('bookingFormStatus');
                    statusDiv.innerHTML = `
                         <div class="bg-[#f2faf6] border border-[#d1e7dd] text-[#0a5b46] px-4 py-3 rounded-xl mb-4">
                              <strong class="font-medium">Success!</strong>
                              <span class="block mt-1"> ${data.message || 'Your booking request has been sent. We\'ll contact you shortly.'}</span>
                         </div>
                    `;
                    statusDiv.classList.remove('hidden');
                    
                    // Reset form
                    this.reset();
                    
                    // Scroll to status message
                    statusDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // Reset button
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
               })
               .catch(error => {
                    // Show error message
                    const statusDiv = document.getElementById('bookingFormStatus');
                    statusDiv.innerHTML = `
                         <div class="bg-[#fdf5f5] border border-[#f8d7da] text-[#842029] px-4 py-3 rounded-xl mb-4">
                              <strong class="font-medium">Error!</strong>
                              <span class="block mt-1"> There was a problem submitting your booking. Please try again or contact us directly.</span>
                         </div>
                    `;
                    statusDiv.classList.remove('hidden');
                    
                    // Scroll to status message
                    statusDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // Reset button
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                    
                    console.error('Error:', error);
               });
          });

          // Tour Summary Modal Functions
          const tourSummaryModal = document.getElementById('tourSummaryModal');
          const tourSummaryBtn = document.getElementById('tourSummaryBtn');
          
          function openTourSummaryModal() {
               tourSummaryModal.classList.remove('opacity-0', 'pointer-events-none');
               document.body.style.overflow = 'hidden';
          }
          
          function closeTourSummaryModal() {
               tourSummaryModal.classList.add('opacity-0', 'pointer-events-none');
               document.body.style.overflow = '';
          }
          
          // Event Listeners
          tourSummaryBtn.addEventListener('click', openTourSummaryModal);
          
          // Close modal when clicking outside
          tourSummaryModal.addEventListener('click', function(e) {
               if (e.target === tourSummaryModal) {
                    closeTourSummaryModal();
               }
          });
          
          // Close modal when pressing Escape key
          document.addEventListener('keydown', function(e) {
               if (e.key === 'Escape' && !tourSummaryModal.classList.contains('opacity-0')) {
                    closeTourSummaryModal();
               }
          });
     </script>
</body>
</html>